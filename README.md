
# Go High-Load Microservice

## Описание проекта
Данный проект представляет собой высоконагруженный микросервис, реализованный на языке Go.  
Сервис предоставляет RESTful HTTP API для управления пользовательскими данными и демонстрирует основные подходы к разработке high-load систем: конкурентная обработка запросов, ограничение скорости, сбор метрик и контейнеризация.

Проект выполнен в рамках учебного задания и имитирует реальный production-сценарий работы микросервиса под высокой нагрузкой.

---

## Функциональные возможности

### REST API (CRUD)

Реализованы следующие HTTP-эндпоинты:

| Метод | URL | Описание |
|------|-----|---------|
| GET | `/api/users` | Получение списка всех пользователей |
| GET | `/api/users/{id}` | Получение пользователя по ID |
| POST | `/api/users` | Создание нового пользователя |
| PUT | `/api/users/{id}` | Обновление данных пользователя |
| DELETE | `/api/users/{id}` | Удаление пользователя |

---

### Конкурентная обработка

В проекте используются **goroutines** для асинхронных операций:

- логирование действий пользователя (CREATE / UPDATE / DELETE);
- выполнение вспомогательных операций без блокировки основного HTTP-потока.

Для безопасного доступа к данным используется `sync.Mutex`.

---

### Rate Limiting

Реализовано ограничение скорости запросов с помощью библиотеки  
`golang.org/x/time/rate`.

Параметры:

- **1000 запросов в секунду**
- **burst = 5000** (для стабильной работы при нагрузочном тестировании)

При превышении лимита сервис возвращает HTTP `429 Too Many Requests`.

---

### Мониторинг и метрики

Добавлен endpoint `/metrics` для Prometheus.

Собираемые метрики:

- общее количество HTTP-запросов (`http_requests_total`);
- время обработки запросов (`http_request_duration_seconds`);
- runtime-метрики Go (goroutines, GC, память).

---

## Технологический стек

- **Go** 1.22+
- **gorilla/mux** — HTTP-роутинг
- **golang.org/x/time/rate** — rate limiting
- **prometheus/client_golang** — сбор метрик
- **Docker** — контейнеризация
- **docker-compose** — локальный запуск
- **wrk** — нагрузочное тестирование

---

## Структура проекта

```

go-microservice/
├── main.go
├── handlers/
│   └── user_handler.go
├── services/
│   └── user_service.go
├── models/
│   └── user.go
├── utils/
│   ├── logger.go
│   └── rate_limiter.go
├── metrics/
│   └── prometheus.go
├── Dockerfile
├── docker-compose.yml
├── go.mod
├── go.sum
└── README.md

````

---

## Запуск проекта

### Локально через Docker

В корне проекта выполните команду:

```bash
docker compose up --build
````

После запуска сервис будет доступен по адресу:

```
http://localhost:8080
```

---

## Примеры запросов

### Создание пользователя

```bash
curl -X POST http://localhost:8080/api/users \
-H "Content-Type: application/json" \
-d '{"name":"Pavel","email":"pavel@test.ru"}'
```

### Получение списка пользователей

```bash
curl http://localhost:8080/api/users
```

---

## Метрики Prometheus

```bash
curl http://localhost:8080/metrics
```

---

## Нагрузочное тестирование

Для проверки работы сервиса под высокой нагрузкой используется `wrk`.

### Команда запуска теста

```bash
wrk -t12 -c500 -d60s http://localhost:8080/api/users
```

### Ожидаемые результаты

* **RPS** > 1000
* **Средняя latency** < 10 ms
* **Ошибки**: отсутствуют (0%)

---

## Дополнительные доработки

В ходе выполнения задания были внесены следующие улучшения:

* увеличен параметр `burst` в rate limiter до **5000** для корректного прохождения нагрузочного теста;
* асинхронное логирование вынесено в `goroutines` для снижения latency;
* добавлены Prometheus-метрики для анализа производительности и мониторинга.

---

## Назначение проекта

Проект предназначен для демонстрации:

* принципов разработки высоконагруженных микросервисов;
* работы с конкурентностью в Go;
* инструментов мониторинга и тестирования;
* контейнеризации и подготовки сервиса к production-развертыванию.

```
